:root {
  --bg-top: #f5efe2;
  --bg-bottom: #e3ecdf;
  --paper: #fffdf8;
  --ink: #1e2a2f;
  --muted: #5f6c73;
  --accent: #0d6a6b;
  --accent-soft: #d8eeec;
  --warn: #b05524;
  --ok: #1e7e4d;
  --edge: #a5b3b8;
  --node: #ffffff;
  --node-in: #1f6e6f;
  --node-add: #f2bb73;
  --node-remove: #d67c45;
}

* {
  box-sizing: border-box;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: "Iowan Old Style", "Palatino Linotype", "Book Antiqua", Palatino, "URW Palladio L", serif;
  color: var(--ink);
  background: linear-gradient(165deg, var(--bg-top) 0%, var(--bg-bottom) 100%);
}

sub,
sup {
  font-size: 0.72em;
  line-height: 0;
  position: relative;
  vertical-align: baseline;
}

sub {
  bottom: -0.23em;
}

sup {
  top: -0.42em;
}

code {
  font-family: "Menlo", "Monaco", "Courier New", monospace;
  font-size: 0.92em;
  background: #f0f5f7;
  border-radius: 0.3rem;
  padding: 0.12rem 0.28rem;
}

.hero {
  padding: 1.3rem 1.1rem 0.8rem;
  border-bottom: 1px solid #d3ddd7;
}

.hero h1 {
  margin: 0;
  font-size: 1.8rem;
  letter-spacing: 0.02rem;
}

.hero p {
  margin-top: 0.55rem;
  max-width: 72rem;
  color: var(--muted);
  line-height: 1.42;
}

.layout {
  display: grid;
  grid-template-columns: minmax(16rem, 20rem) minmax(20rem, 1fr) minmax(18rem, 24rem);
  gap: 1rem;
  padding: 1rem;
}

.panel {
  background: color-mix(in oklab, var(--paper) 94%, #ffffff 6%);
  border: 1px solid #d4dfda;
  border-radius: 0.8rem;
  padding: 0.9rem;
  box-shadow: 0 8px 26px -22px #000;
  animation: rise 260ms ease-out;
}

@keyframes rise {
  from {
    opacity: 0;
    transform: translateY(8px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.panel h2 {
  margin: 0 0 0.6rem;
  font-size: 1.08rem;
}

.controls {
  display: grid;
  gap: 0.72rem;
  align-content: start;
}

.control-block {
  background: #f3f8f7;
  border: 1px solid #d2dfdd;
  border-radius: 0.52rem;
  padding: 0.66rem;
}

.control-block h2 {
  margin: 0 0 0.5rem;
  font-size: 1.02rem;
}

.control-block .small {
  margin: 0.12rem 0 0.55rem;
}

.control-block .report {
  margin-bottom: 0;
}

.small {
  margin: 0.2rem 0 0.6rem;
  color: var(--muted);
  line-height: 1.35;
}

.grid-controls {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 0.6rem;
}

label[for="weight-k"] {
  grid-column: span 2;
}

label {
  display: flex;
  flex-direction: column;
  gap: 0.28rem;
  font-size: 0.95rem;
}

select,
input,
button {
  border: 1px solid #b3c1c8;
  border-radius: 0.45rem;
  background: #fff;
  font-size: 0.95rem;
  padding: 0.45rem 0.5rem;
  color: var(--ink);
}

button {
  cursor: pointer;
  transition: transform 160ms ease, background 160ms ease;
}

button:hover {
  background: #eef4f5;
  transform: translateY(-1px);
}

button:disabled {
  cursor: not-allowed;
  opacity: 0.62;
  transform: none;
}

#rebuild,
#reset-ideal {
  grid-column: span 2;
}

.root-buttons {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(4.4rem, 1fr));
  gap: 0.5rem;
}

.root-buttons button {
  padding: 0.42rem;
}

#apply-fon-der-flaass {
  width: 100%;
  margin-bottom: 0.55rem;
}

.coxeter-builder {
  display: grid;
  grid-template-columns: 1fr;
  gap: 0.5rem;
}

.orbit-controls {
  display: grid;
  gap: 0.45rem;
}

.orbit-buttons {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 0.45rem;
}

#orbit-speed-value {
  margin-top: -0.18rem;
  margin-bottom: 0.2rem;
}

.coxeter-list {
  margin-top: 0.45rem;
  display: grid;
  gap: 0.42rem;
}

.coxeter-item {
  display: grid;
  grid-template-columns: 1fr auto auto;
  align-items: center;
  gap: 0.45rem;
  background: #f5faf9;
  border: 1px solid #d2e0de;
  border-radius: 0.42rem;
  padding: 0.42rem;
}

.coxeter-word {
  font-family: "Menlo", "Monaco", "Courier New", monospace;
  color: #26454f;
  font-size: 0.9rem;
}

.coxeter-item button {
  padding: 0.35rem 0.5rem;
}

.coxeter-remove {
  background: #fff7f4;
  border-color: #dbb8a7;
}

#poset-svg {
  width: 100%;
  min-height: 19rem;
  border: 1px solid #d2ded8;
  border-radius: 0.6rem;
  background: radial-gradient(circle at 20% 15%, #fefcf6 0, #f5f9f2 58%, #edf4ec 100%);
}

.edge {
  stroke: var(--edge);
  stroke-width: 2;
}

.node circle {
  fill: var(--node);
  stroke: #44666f;
  stroke-width: 2;
  transition: fill 200ms ease, stroke 200ms ease, r 200ms ease;
}

.node.in-ideal circle {
  fill: var(--node-in);
  stroke: #0f4f50;
}

.node.can-add circle {
  stroke: var(--node-add);
  stroke-dasharray: 3 2;
}

.node.can-remove circle {
  stroke: var(--node-remove);
}

.node.recent circle {
  stroke-width: 3;
}

.node text {
  text-anchor: middle;
  dominant-baseline: middle;
  font-size: 0.88rem;
  font-weight: 600;
  fill: #173036;
  user-select: none;
}

.node.in-ideal text {
  fill: #f8fffe;
}

.legend {
  margin-top: 0.55rem;
  display: flex;
  gap: 1rem;
  flex-wrap: wrap;
  color: var(--muted);
  font-size: 0.92rem;
}

.swatch {
  display: inline-block;
  width: 0.9rem;
  height: 0.9rem;
  border-radius: 0.18rem;
  border: 1px solid #768891;
  vertical-align: middle;
  margin-right: 0.3rem;
}

.swatch.in-ideal {
  background: var(--node-in);
}

.swatch.can-add {
  background: color-mix(in oklab, var(--node-add) 65%, white 35%);
}

.swatch.can-remove {
  background: color-mix(in oklab, var(--node-remove) 68%, white 32%);
}

.report {
  background: #f3f8f7;
  border: 1px solid #d2dfdd;
  border-radius: 0.5rem;
  padding: 0.65rem;
  line-height: 1.38;
  font-size: 0.95rem;
  margin-bottom: 0.68rem;
  overflow-wrap: anywhere;
}

.report strong {
  color: #183038;
}

.report code {
  background: #e9f0f4;
}

.state-key-title {
  font-size: 0.76rem;
  letter-spacing: 0.045rem;
  text-transform: uppercase;
  color: #49636b;
  margin-bottom: 0.2rem;
}

.state-key-main {
  font-size: 1.04rem;
  font-weight: 700;
  color: #183840;
  letter-spacing: 0.01rem;
  line-height: 1.34;
  margin-bottom: 0.28rem;
}

.state-sub {
  color: var(--muted);
}

.math-table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 0.35rem;
  font-size: 0.94rem;
}

.math-table td {
  padding: 0.16rem 0.22rem;
  border-bottom: 1px dashed #d8e4e1;
  vertical-align: top;
  font-variant-numeric: tabular-nums;
}

.math-table tr:last-child td {
  border-bottom: none;
}

.math-table td.key {
  width: 36%;
  color: #35535b;
  font-weight: 600;
}

.comparison-table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 0.5rem;
  font-size: 0.9rem;
}

.comparison-table th,
.comparison-table td {
  padding: 0.22rem 0.28rem;
  border-bottom: 1px dashed #d8e4e1;
  text-align: left;
  vertical-align: top;
  font-variant-numeric: tabular-nums;
}

.comparison-table th {
  font-weight: 700;
  color: #35535b;
  font-size: 0.83rem;
  letter-spacing: 0.02rem;
}

.comparison-table tr:last-child td {
  border-bottom: none;
}

.comparison-table td.key {
  font-weight: 600;
  color: #35535b;
}

.prediction-table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 0.16rem;
  font-size: 0.9rem;
}

.prediction-table td {
  padding: 0.24rem 0.26rem;
  border-bottom: 1px dashed #d8e4e1;
  vertical-align: top;
  line-height: 1.45;
  font-variant-numeric: tabular-nums;
}

.prediction-table tr:last-child td {
  border-bottom: none;
}

.prediction-table td.key {
  width: 42%;
  color: #35535b;
  font-weight: 600;
}

.source-tag {
  display: inline-block;
  margin-right: 0.33rem;
  margin-top: 0;
  padding: 0.04rem 0.34rem;
  border-radius: 999px;
  border: 1px solid #c8dad6;
  background: #e7f1ef;
  color: #2f5059;
  font-size: 0.68rem;
  font-weight: 700;
  letter-spacing: 0.03rem;
  text-transform: uppercase;
  vertical-align: middle;
}

.formula {
  color: #23414a;
  font-family: "Cambria Math", "STIX Two Math", "Times New Roman", serif;
  letter-spacing: 0.01rem;
}

.formula-inline {
  color: #23414a;
  font-family: "Cambria Math", "STIX Two Math", "Times New Roman", serif;
  letter-spacing: 0.01rem;
}

.prediction-context {
  margin-bottom: 0.45rem;
  color: #2d4b54;
  font-size: 0.92rem;
  line-height: 1.35;
}

.q-product {
  display: inline-flex;
  align-items: center;
  gap: 0.24rem;
  flex-wrap: wrap;
}

.q-poly {
  letter-spacing: 0;
  line-height: 1.5;
  font-size: 0.94rem;
  overflow-wrap: anywhere;
}

.frac {
  display: inline-grid;
  grid-template-rows: auto auto;
  text-align: center;
  vertical-align: middle;
  line-height: 1.06;
  margin: 0 0.1rem;
}

.frac .num {
  border-bottom: 1px solid #69818a;
  padding: 0 0.24rem 0.06rem;
}

.frac .den {
  padding-top: 0.05rem;
}

.computed-value {
  font-weight: 700;
  color: #183a43;
  background: #e9f1ef;
  border: 1px solid #cfe0dc;
  border-radius: 0.26rem;
  padding: 0.02rem 0.24rem;
}

.source-footnote {
  margin-top: 0.45rem;
  color: var(--muted);
  font-size: 0.86rem;
}

.citation-title {
  margin-top: 0.55rem;
  font-size: 0.76rem;
  letter-spacing: 0.045rem;
  text-transform: uppercase;
  color: #49636b;
}

.citation-line {
  margin-top: 0.32rem;
  color: #35535b;
  font-size: 0.9rem;
  line-height: 1.35;
}

.citation-line a {
  color: #1f5c6a;
  text-decoration: underline;
  text-underline-offset: 0.1rem;
}

.math-exterior {
  display: inline-block;
  line-height: 1.05;
  white-space: nowrap;
  font-family: "Cambria Math", "STIX Two Math", "Times New Roman", serif;
}

.math-exterior sup {
  font-size: 0.72em;
  vertical-align: 0.45em;
}

.math-exterior .bb-c {
  font-style: normal;
}

.math-details {
  margin-top: 0.55rem;
  border: 1px solid #cfddda;
  border-radius: 0.45rem;
  background: #f8fbfa;
}

.math-details summary {
  cursor: pointer;
  list-style: none;
  padding: 0.5rem 0.56rem;
  font-weight: 600;
  color: #28454e;
}

.math-details summary::-webkit-details-marker {
  display: none;
}

.math-details summary::before {
  content: "\25b8";
  margin-right: 0.42rem;
  color: #3f626a;
}

.math-details[open] summary::before {
  content: "\25be";
}

.math-details-body {
  padding: 0 0.56rem 0.56rem;
  color: var(--muted);
  line-height: 1.4;
}

.math-line {
  margin-top: 0.36rem;
}

.muted {
  color: var(--muted);
}

.ok {
  color: var(--ok);
  font-weight: 700;
}

.warn {
  color: var(--warn);
  font-weight: 700;
}

.footnote {
  padding: 0 1rem 1rem;
  color: var(--muted);
}

.dev-notes {
  margin-top: 0;
  border: none;
  border-radius: 0;
  background: transparent;
}

.dev-notes summary {
  cursor: pointer;
  list-style: none;
  padding: 0;
  font-weight: 600;
  color: #244047;
}

.dev-notes summary::-webkit-details-marker {
  display: none;
}

.dev-notes summary::before {
  content: "\25b8";
  margin-right: 0.45rem;
  color: #3f626a;
}

.dev-notes[open] summary::before {
  content: "\25be";
}

.dev-notes-body {
  padding: 0.52rem 0 0;
}

@media (max-width: 1020px) {
  .layout {
    grid-template-columns: 1fr;
  }
  .grid-controls {
    grid-template-columns: 1fr;
  }
  #rebuild,
  #reset-ideal {
    grid-column: span 1;
  }
}
